$marker-shadow:0 1px 4px rgba(0,0,0,.6);

$markers2: (
    mini: (
        size: 10px,
        arrow: 0,
        thin: .8,
        border: 1px,
        text:0
    ),
    focus: (
        size: 20px,
        arrow: 5px,
        thin: .8,
        border: 1px,
        text:7px
    ),
    active: (
        size: 36px,
        arrow: 8px,
        thin: .8,
        border: 1px,
        text:12px
    ),
);

.map-marker2 {
    text-align:center;
    background:#eee;

    >div {
        position:relative;
        animation-fill-mode: forwards;
        transform-origin:50% 100%;

        >span:first-child {
            display:block;
            position:relative;
            z-index:1;
            background-color:$marker-color;
            border:$marker-border-width solid $marker-border-color;
            border-radius:50%;
            box-shadow:$marker-shadow;

            // &:after {
            //     width:100%;
            //     height:100%;
            //     display:block;
            //     content:'';
            //     position:absolute;
            //     top:0;
            //     left:0;
            //     z-index:3;
            //     border-radius:50%;
            //     background-color:red;
            // }

            +span {
                margin:0 auto;
                background-color:$marker-color;
                position:relative;
                z-index:2;
                top:0;
                border-right:$marker-border-width solid $marker-border-color;
                border-bottom:$marker-border-width solid $marker-border-color;
                box-shadow:$marker-shadow;
            }// arrow
        }// head

        >div {
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            position:absolute;
            z-index:2;
            overflow:hidden;
            line-height:1;
            word-break: break-all;
            background-color:$marker-color;
            border-radius:50%;
        }// content
    }// wrapper

    @each $name, $values in $markers2 {
        $size: map-get($values, size);
        $border: map-get($values, border);
        $arrow: map-get($values, arrow);
        $thin: map-get($values, thin);
        $text: map-get($values, text);
        $diagonal:round(sqrt(pow(strip-unit($arrow), 2) + pow(strip-unit($arrow), 2))) + 0px;

        &.#{$name} {
            width:$size;
            height:$size + round($diagonal / 2);

            >div {
                // transform-origin:#{round($size / 2)} #{$size + round($diagonal / 2)};
                >span:first-child {
                    width:$size;
                    height:$size;
                    padding:$border;
                    border-width:$border;

                    +span {
                        @if $arrow == 0 {
                            display:none;
                        } @else {
                            display:block;
                            width:$arrow;
                            height:$arrow;
                            transform:translateY(-50%) scaleX($marker-arrow-thin) rotate(45deg);
                            border-right-width:$border;
                            border-bottom-width:$border;
                        }
                    }
                }

                >div {
                    width:($size - ($border * 2));
                    height:($size - ($border * 2));
                    top:$border;
                    left:$border;
                    @if $text != 0 {
                        font-size:$text;
                    }
                }
            }
        }
    }

    &.focus {
        >div {
            animation: mapMarkerFocus 3s ease-in-out;
        }
    }

    &.active {
        >div {
            // perspective: 1000;
            animation: mapMarkerActive 2s 1 ease-in-out;
        }
    }

    &.ready {
        >div {
            animation: mapMarkerReady 3s ease-in-out;
        }
        
        
    }
}

.map-marker {
    display:flex;
    flex-direction: column;
    align-items:center;
    position:relative;
    z-index:1;

    &:before {
        content:'';
        display:block;
        position:absolute;
        top:0;
        left:0;
        z-index:-1;
        background-color:$marker-color;
        border-radius:$marker-radius;
        border:$marker-border-width solid $marker-border-color;
        box-shadow:$marker-shadow;
    }

    &:after {
        content:'';
        display:block;
        background-color:$marker-color;
        position:relative;
        z-index:1;
        top:-1px;
        transform:translateY(-50%) scaleX($marker-arrow-thin) rotate(45deg);
        border-right:$marker-border-width solid $marker-border-color;
        border-bottom:$marker-border-width solid $marker-border-color;
        box-shadow:$marker-shadow;
    }

    >div {
        position:relative;
        z-index:2;
        // border-radius:$marker-radius;
        text-align:center;
        text-shadow:
            1px 1px 0 #fff,
            -1px -1px 0 #fff,
            1px -1px 0 #fff,
            -1px 1px 0 #fff
        ;
        line-height:1;

        &:before {
            display:block;
            content:'';
            position:absolute;
            top:$marker-border-width;
            left:$marker-border-width;
            z-index:-1;
            background-color:$marker-color;
            border-radius:$marker-radius;
            border:#{$marker-border-width + 1} solid transparent;
        }

        &:after {
            display:block;
            content:'';
            width:50%;
            height:50%;
            position:absolute;
            top:50%;
            left:50%;
            z-index:-1;
            transform:translate(-50%, -50%);
            background-color:lighten($marker-color, 20%);
            border-radius:50%;
        }

        >div {
            display:flex;
            flex-direction: column;
            justify-content:center;
            align-items:center;
            position:relative;
            border-radius:$marker-radius;
            border:#{$marker-border-width + 2} solid transparent;
            overflow:hidden;

            >img {
                position:absolute;
                top:50%;
                left:50%;
                max-width:100%;
                max-height:100%;
                transform:translate(-50%, -50%);
            }
        }
    }

    @each $name, $values in $marker-sizes {
        $size: map-get($values, size);
        $arrow: map-get($values, arrow);
        $text: map-get($values, text);
        $diagonal:round(sqrt(pow(strip-unit($arrow), 2) + pow(strip-unit($arrow), 2))) + 0px;

        &.#{$name} {
            width:$size;
            height:#{$size + round($diagonal / 2)};
            transform-origin:#{round($size / 2)} #{$size + round($diagonal / 2)};

            &:before, >div, >div>div {
                width:$size;
                height:$size;
            }

            >div:before {
                width:#{$size - ($marker-border-width * 2)};
                height:#{$size - ($marker-border-width * 2)};
            }

            >div>div {
                font-size: $text;
            }

            &:after {
                width:$arrow;
                height:$arrow;
                margin-bottom:-#{round($diagonal / 2)};
            }
        }
    }

    &.ready {
        animation: mapMarkerReady 3s 1 ease-in-out;
    }

    &.focused {
        animation: mapMarkerFocused 3s ease-in-out;
    }

    &.dragging {
        &:before, &:after {
            box-shadow:0 10px 4px rgba(0,0,0,.6);
        }
    }
}


@keyframes mapMarkerReady {
    0% { transform: translateY(-70%) scale(.9, .9); }
    4% { transform: translateY(0) scale(.9, .9); }
    6% { transform: scale(1.1, .4); }
    9% { transform: scale(.9, 1.1); }
    13% { transform: scale(1.1, .9); }
    18% { transform: scale(1, 1); }
    100% { transform: scale(1, 1); }
}

@keyframes mapMarkerFocus {
    0% { transform: scale(1.1, 1.1); }
    4% { transform: scale(.9, .9); }
    6% { transform: scale(1.1, .4); }
    9% { transform: scale(.9, 1.1); }
    13% { transform: scale(1.1, .9); }
    18% { transform: scale(1, 1); }
    100% { transform: scale(1, 1); }
}

@keyframes mapMarkerActive {
    0% { transform: translateY(-10%) scale(1.1, 1) rotateY(90deg); }
    6% { transform: translateY(-30%) scale(1.2, 1) rotateY(180deg); }
    12% { transform: translateY(-5%) scale(1.1, 1) rotateY(90deg); }
    18% { transform: translateY(0) scale(1.3, .8) rotateY(0deg); }
    22% { transform: translateY(0) scale(.9, 1.1) rotateY(0deg); }
    26% { transform: translateY(0) scale(1, 1) rotateY(0deg); }
    100% { transform: translateY(0) scale(1, 1) rotateY(0deg); }
}
